
/*根据视频网页地址智能获取分享地址，目前只支持优酷、腾讯视频、土豆视频。其他的爱奇艺、新浪、56等视频网站因为规则不确定无法获取*/
/*通用Iframe*/
/*各网站url地址规则*/
var youkuUrl = "http://player.youku.com/embed/{1}",
qqUrl = "https://v.qq.com/iframe/player.html?vid\x3d{1}\x26tiny\x3d0\x26auto\x3d0",
tudouUrl1 = "http://www.tudou.com/programs/view/html5embed.action?type\x3d1\x26code\x3d{2}\x26lcode\x3d{1}\x26resourceId\x3d0_06_05_99",
tudouUrl2 = "http://www.tudou.com/programs/view/html5embed.action?type\x3d0\x26code\x3d{1}\x26lcode\x3d\x26resourceId\x3d0_06_05_99",
youkuSub = "v.youku.com/v_show/id_",
qqSubCoverRegex = /.html\?vid=([^]+)/,
qqSubPageRegex = /\/([^]{11}).html/,
youkunRegex = /\/id_([^]+).html/,
youkunRegex1 = /\/id_([^]+)==/,
tudouRegex1 = /tudou.com\/[^]+\/([^]+)\/([^]+).html/,
tudouRegex2 = /tudou.com\/[^]+\/view\/([^]+)/,
qqSub = "qq.com/",
tudouSub = "tudou.com/";
function getUrlFromRegex(a, b, c) {
    a = a.match(c);
    if (null != a) {
        for (c = 1; c < a.length; c++) b = b.replace("{" + c.toString() + "}", a[c]);
        return b
    }
    return ""
}
function getUrl(a) {
    if (0 <= a.indexOf(qqSub)) {
        var b = getUrlFromRegex(a, qqUrl, qqSubCoverRegex);
        if ("" == b || void 0 == b || null == b) b = getUrlFromRegex(a, qqUrl, qqSubPageRegex);
        return b
    }
};

function saveVideo() {
    var c = $("#txtvideourl").val().replace("https:", "http:");
    if (null == c.match(/http:\/\/[^]+\.[^]+/)) alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u89c6\u9891\u5730\u5740\r\n\u5305\u542bhttp://"),
    $("#txtvideourl").focus();
    else {
        $('#content').append('<div class="iframe"><iframe src="'+c+'" frameborder="0" width="640" height="498" allowfullscreen id="link_"></iframe><div class="file-panel"><span class="cancel"></span></div></div>');
        $('#content').append('<div contenteditable="true" class="inp-item placeholder"></div>');

        $('.linkbox, .mask').hide();
    }
}

$(function() {

    setTimeout(function(){
      $("#link_").contents().find("video").addClass('ssss');
      // $(window.frames["link_"].document).find("video").attr('preload', 'auto').attr('x5-video-player-type', 'h5');
    }, 2000);

    $(document).on("click", ".temp-video-online", function() {
      saveVideo();
    });


    $('#content').delegate('.iframe .file-panel', 'click', function(){
      var t = $(this), iframe = t.closest('.iframe'), inpItem = iframe.next('.inp-item');
      if (inpItem.html() == "") {
        inpItem.remove();
      }
      iframe.remove();
    })

});
